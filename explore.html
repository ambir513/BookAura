<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bookaura - Explore Books</title>
    <!-- Load Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Base Reset and Typography */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        
        /* Main Content Area */
        .content-area {
            padding: 1.5rem 1.5rem 0;
        }
        .container {
            max-width: 1280px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .main-header-card {
            text-align: center;
            margin-bottom: 2.5rem;
            padding: 1.5rem;
            background: transparent;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
        }
        .dark .main-header-card {
            background-color: #1f2937;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.25);
        }

        .main-header-card h1 {
            font-size: 2.25rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        .dark .main-header-card h1 {
            color: #ffffff;
        }
        
        .main-header-card p {
            font-size: 1.125rem;
            color: #6b7280;
        }
        .dark .main-header-card p {
            color: #9ca3af;
        }

        /* Search Input */
        .search-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
            max-width: 32rem;
            margin-left: auto;
            margin-right: auto;
        }

        .search-input-group input {
            flex-grow: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .dark .search-input-group input {
            border-color: #4b5563;
            background-color: #374151;
            color: #e5e7eb;
        }
        .search-input-group input:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px #6366f1;
        }

        .search-input-group button {
            padding: 0.75rem 1.5rem;
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .search-input-group button:hover {
            background-color: #4338ca;
        }
        .search-input-group button span {
            display: none; /* Hide text on small screens */
        }

        /* Book List & Results */
        .book-list {
            margin-top: 2rem;
        }
        
        .book-list h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        .dark .book-list h2 {
            color: #ffffff;
            border-bottom-color: #374151;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1.5rem;
        }

        /* Book Card */
        .book-card {
            background: transparent;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .dark .book-card {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        .book-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .book-card-content {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .book-metadata {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .book-cover {
            width: 5rem; /* 80px */
            height: 7.5rem; /* 120px */
            object-fit: cover;
            border-radius: 0.375rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .book-details {
            flex-grow: 1;
        }
        .book-details h3 {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.25rem;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            /* -webkit-line-clamp: 2; */
            -webkit-box-orient: vertical;
        }
        .dark .book-details h3 {
            color: #ffffff;
        }
        .book-details .author {
            font-size: 0.875rem;
            color: #4f46e5;
            font-weight: 500;
            margin-top: 0.25rem;
        }
        .dark .book-details .author {
            color: #a5b4fc;
        }
        .book-details .date {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }

        .book-description {
            font-size: 0.875rem;
            color: #4b5563;
            margin-bottom: 1rem;
            flex-grow: 1;
        }
        .dark .book-description {
            color: #d1d5db;
        }
        
        .action-button-wrapper {
            margin-top: auto;
        }

        .preview-btn {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            text-decoration: none;
        }

        .preview-btn.available {
            background-color: #10b981;
            color: white;
        }
        .preview-btn.available:hover {
            background-color: #059669;
        }
        .preview-btn.disabled {
            background-color: #d1d5db;
            color: #6b7280;
            cursor: not-allowed;
        }
        .dark .preview-btn.disabled {
            background-color: #4b5563;
            color: #9ca3af;
        }

        /* Loading Spinner */
        .spinner-wrapper {
            text-align: center;
            padding: 3rem 0;
            display: none;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #10b981;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 1rem;
        }
        .dark .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #10b981;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loading-text {
            color: #6366f1;
            font-weight: 500;
        }
        .dark .loading-text {
             color: #a5b4fc;
        }
        
        .no-results {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        .dark .no-results {
            color: #9ca3af;
        }

        
        /* Media Queries for Responsiveness */
        @media (min-width: 640px) {
            .search-input-group {
                flex-direction: row;
            }
            .search-input-group button span {
                display: inline;
            }
            .search-input-group button i {
                margin-right: 0.5rem;
            }
            .books-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            #userIdDisplay {
                display: block; /* Show status on tablet/desktop */
            }
        }
        
        @media (min-width: 768px) {
           
            .content-area {
                padding-bottom: 2rem; /* Restore normal bottom padding */
            }
            .main-header-card h1 {
                font-size: 2.5rem;
            }
            .main-header-card {
                padding: 2.5rem;
            }
        }

        @media (min-width: 1024px) {
            .books-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
       
    </style>
</head>
<body class="min-h-screen">
    <div class="container">
      <!-- Top Navigation Bar -->
      <nav class="top-nav">
        <div class="logo">BOOKAURA</div>
        <div class="nav-links">
          <a href="index.html" >Home</a>
          <a href="explore.html" class="active">Explore</a>
          <a href="book.html">Book</a>
          <!-- <a href="library.html">Library</a> -->
          <a href="posts.html">Posts</a>
        </div>
        <div class="nav-right">
          <button class="toggle-btn" id="modeToggle">
            <i class="fas fa-moon"></i>
          </button>
          <button class="account-btn" id="accountBtn">
            <i class="fas fa-user-circle"></i>
          </button>

          <!-- Login/Signup Dropdown -->
          <div class="auth-dropdown" id="authDropdown">
            <h3>Welcome to Bookaura</h3>
            <div class="auth-form">
              <input type="email" placeholder="Email Address" id="loginEmail" />
              <input
                type="password"
                placeholder="Password"
                id="loginPassword"
              />
              <button id="loginBtn">Login</button>
              <p>
                Don't have an account? <a href="#" id="showSignup">Sign Up</a>
              </p>
            </div>

            <div class="auth-form" style="display: none" id="signupForm">
              <input type="text" placeholder="Full Name" id="signupName" />
              <input
                type="email"
                placeholder="Email Address"
                id="signupEmail"
              />
              <input
                type="password"
                placeholder="Password"
                id="signupPassword"
              />
              <button id="signupBtn">Create Account</button>
              <p>
                Already have an account? <a href="#" id="showLogin">Login</a>
              </p>
            </div>
            <div style="display: none" id="dashboard">
              <p id="UserName"></p>
              <p id="UserEmail"></p>
              <button class="logout" id="logout">Logout</button>
            </div>
          </div>
        </div>
      </nav>


    <!-- Bottom Navigation for Mobile -->
    <nav class="bottom-nav">
      <div class="bottom-nav-links">
        <a href="index.html" class="bottom-nav-link">
          <i class="fas fa-home"></i>
          <span>Home</span>
        </a>
        <a href="explore.html" class="bottom-nav-link active">
          <i class="fas fa-compass"></i>
          <span>Explore</span>
        </a>
        <a href="book.html" class="bottom-nav-link">
          <i class="fas fa-book"></i>
          <span>Book</span>
        </a>
        <!-- <a href="library.html" class="bottom-nav-link">
          <i class="fas fa-book-open"></i>
          <span>Library</span>
        </a> -->
        <a href="posts.html" class="bottom-nav-link">
          <i class="fas fa-file-alt"></i>
          <span>Posts</span>
        </a>
      </div>
    </nav>
  

        <!-- Main Content Area (Book Finder) -->
        <main class="content-area">
            <div class="container max-w-4xl" style="margin-left: auto; margin-right: auto;">
                <div class="main-header-card" id="title">
                    <!-- <h1 id="header">Book Finder</h1> -->
                    

                    <!-- Search Input and Button -->
                    <div class="search-input-group" id="input">
                        <input id="search-box" type="text" placeholder="Search for a title, author, or keyword...">
                        <button id="search">
                            <i class="fas fa-search"></i> 
                            <span>Search</span>
                        </button>
                    </div>
<br><br>
                    <p>Discover millions of titles from the Google Books Library.</p>
                </div>
                
                <div class="book-list">
                    <h2>
                        <span id="resultHeader">Search Results</span>
                    </h2>
                    
                    <div class="spinner-wrapper hidden" id="loadingIndicator">
                        <div class="spinner"></div>
                        <p class="loading-text">Searching the library...</p>
                    </div>

                    <div id="list-output">
                        <div class="books-grid" id="books-container">
                            <p class="no-results"></p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- JavaScript and Firebase Implementation -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, signOut, onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration & Global State ---
        // NOTE: The API key is included here for the Google Books API.
        const GOOGLE_BOOKS_API_KEY = "AIzaSyC50a8sRlI9YdrUrE1JxSdMj60P5TekymQ";
        const BOOKS_API_BASE_URL = "https://www.googleapis.com/books/v1/volumes";
        
        let auth, db, userId = null;
        let isAuthReady = false;

        // UI Element Map
        const ui = {
            // Auth
            authDropdown: document.getElementById('authDropdown'),
            accountBtn: document.getElementById('accountBtn'),
            loginForm: document.getElementById('loginForm'),
            signupForm: document.getElementById('signupForm'),
            profileForm: document.getElementById('profileForm'),
            showSignup: document.getElementById('showSignup'),
            showLogin: document.getElementById('showLogin'),
            authTitle: document.getElementById('authTitle'),
            authMessage: document.getElementById('authMessage'),
            loginBtn: document.getElementById('loginBtn'),
            signupBtn: document.getElementById('signupBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            userIdDisplay: document.getElementById('userIdDisplay'),
            userName: document.getElementById('userName'),
            profileUserId: document.getElementById('profileUserId'),
            
            // Search
            searchBox: document.getElementById('search-box'),
            searchBtn: document.getElementById('search'),
            booksContainer: document.getElementById('books-container'),
            loadingIndicator: document.getElementById('loadingIndicator'),
            resultHeader: document.getElementById('resultHeader'),
            
            // Dark Mode
            modeToggle: document.getElementById('modeToggle'),
            sunIcon: document.getElementById('sunIcon'),
            moonIcon: document.getElementById('moonIcon'),
        };

        // --- Firebase Auth & Firestore Setup ---

        function updateAuthUI(user) {
            if (user && user.uid) {
                // Logged In State
                userId = user.uid;
                const displayName = user.email ? user.email.split('@')[0] : 'Guest';
                ui.authTitle.textContent = 'User Profile';
                ui.loginForm.classList.add('hidden');
                ui.signupForm.classList.add('hidden');
                ui.profileForm.classList.remove('hidden');
                ui.userName.textContent = displayName;
                ui.profileUserId.textContent = userId;
                ui.userIdDisplay.textContent = `User ID: ${userId}`; // Display full userId as required
            } else {
                // Logged Out State
                userId = null;
                ui.authTitle.textContent = 'Welcome to Bookaura';
                ui.loginForm.classList.remove('hidden');
                ui.signupForm.classList.add('hidden');
                ui.profileForm.classList.add('hidden');
                ui.userIdDisplay.textContent = 'Signed Out';
                ui.authMessage.textContent = '';
            }
        }

        async function initializeFirebaseAndAuth() {
            try {
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase configuration is missing. Cannot initialize Firestore.");
                } else {
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                }
                
                // Attach auth state listener
                onAuthStateChanged(auth, async (user) => {
                    if (!user) {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            // If no token, sign in anonymously
                            await signInAnonymously(auth);
                        }
                    }
                    updateAuthUI(auth.currentUser);
                    isAuthReady = true;
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                ui.userIdDisplay.textContent = 'Auth Error';
            }
        }

        // --- Auth Event Handlers ---

        
        // --- Google Books API Logic ---

        /**
         * Creates the HTML markup for a single book card result.
         */
        function createBookCard(book) {
            const info = book.volumeInfo;
            const title = info.title || 'No Title Available';
            const authors = info.authors ? info.authors.join(', ') : 'Unknown Author';
            const description = info.description ? info.description.substring(0, 150) + '...' : 'No description available.';
            const imageLink = info.imageLinks ? info.imageLinks.thumbnail : 'https://placehold.co/128x192/E5E7EB/4B5563?text=No+Cover';
            const previewLink = info.previewLink || '#';
            const isPreviewAvailable = info.previewLink && info.previewLink !== '#';

            const buttonClass = isPreviewAvailable ? 'available' : 'disabled';
            const buttonText = isPreviewAvailable ? 'View Preview' : 'No Preview';

            return `
                <div class="book-card">
                    <div class="book-card-content">
                        <!-- Image and Metadata -->
                        <div class="book-metadata">
                            <img src="${imageLink}" onerror="this.onerror=null;this.src='https://placehold.co/128x192/E5E7EB/4B5563?text=No+Cover';" alt="Book Cover" class="book-cover">
                            <div class="book-details">
                                <h3>${title}</h3>
                                <p class="author">${authors}</p>
                                <p class="date">${info.publishedDate ? info.publishedDate.substring(0, 4) : 'N/A'}</p>
                            </div>
                        </div>
                        
                        <!-- Description -->
                        <p class="book-description">${description}</p>
                        
                        <!-- Action Button -->
                        <div class="action-button-wrapper">
                            <a href="${previewLink}" target="_blank" 
                                class="preview-btn ${buttonClass}" 
                                ${isPreviewAvailable ? '' : 'disabled'}
                            >
                                <i class="fas fa-eye" style="margin-right: 0.5rem;"></i> ${buttonText}
                            </a>
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * Handles the main book search functionality by calling the Google Books API.
         */
        async function searchBooks() {
            const query = ui.searchBox.value.trim();
            if (!query) {
                ui.booksContainer.innerHTML = `<p class="no-results" style="color: #ef4444;">Please enter a search term!</p>`;
                return;
            }

            ui.booksContainer.innerHTML = '';
            ui.loadingIndicator.classList.remove('hidden');
            ui.resultHeader.textContent = `Searching for "${query}"...`;

            // Construct the API URL
            const url = `${BOOKS_API_BASE_URL}?q=${encodeURIComponent(query)}&key=${GOOGLE_BOOKS_API_KEY}&maxResults=30`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Google Books API Error: ${response.statusText}`);
                }
                const data = await response.json();

                ui.loadingIndicator.classList.add('hidden');

                if (data.items && data.items.length > 0) {
                    ui.resultHeader.textContent = `Results for "${query}" (${data.items.length} books found)`;
                    data.items.forEach(book => {
                        ui.booksContainer.innerHTML += createBookCard(book);
                    });
                } else {
                    ui.resultHeader.textContent = `No books found for "${query}"`;
                    ui.booksContainer.innerHTML = `<p class="no-results">Your search returned no results. Try a different query!</p>`;
                }
            } catch (error) {
                console.error("Search failed:", error);
                ui.loadingIndicator.classList.add('hidden');
                ui.resultHeader.textContent = `Error during search`;
                ui.booksContainer.innerHTML = `<p class="no-results" style="color: #ef4444;">An error occurred while fetching books. Check the console for details.</p>`;
            }
        }

        // --- Initialize App ---

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Initialize Firebase
            initializeFirebaseAndAuth();

            // 2. Attach search events
            ui.searchBtn.addEventListener('click', searchBooks);
            ui.searchBox.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchBooks();
                }
            });
        });

    </script>
    <script src="script.js"></script>
</body>
</html>



